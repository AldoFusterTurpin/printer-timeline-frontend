<mat-spinner style="margin:0 auto;" *ngIf="loadingSpinner; else dataReady"></mat-spinner>

<ng-template #dataReady>
    <div>
        <!-- 
            if 'height: 100vh' is set in CSS, the tex "Close" of the close button of the left sidenav 
            is sometimes empty (an unexpected thing). That's why the style is here inline. 
        -->
        <mat-sidenav-container style="height:'100vh'">
            <mat-sidenav #rightSidenav mode="side" opened="false" position="end">
                <button class="close-sidenav-button" mat-raised-button color="accent"
                    (click)="rightSidenav.close()">Close
                </button>

                <h4>Details</h4>
                <hr class="solid">

                <div id="details-section" *ngIf="details !== undefined && details !== null">
                    <p><b>Timestamp</b>
                        {{ stringDateToDateObject(details[0]['Value']).toISOString().slice(0, -1).replace('T', ' ') }}
                    </p>
                    <p><b>PN</b> {{details[1]['Value']}}</p>
                    <p><b>SN</b> {{details[2]['Value']}}</p>
                    <p><b>Topic</b> {{details[6]['Value']}}</p>

                    <div [ngSwitch]="elementTypeOfDetails">
                        <button mat-raised-button *ngSwitchCase="elementType.CloudJson" color="primary"
                            matTooltip="Show OpenXML that generated this JSON"
                            (click)="getOpenXmlThatGeneratedTheCloudJson(details[8]['Value']); setTypeOfS3ElementToShow(elementType.OpenXml)">
                            Related OpenXML
                        </button>
                    </div>

                    <button mat-icon-button color="primary" matTooltip="Show element"
                        (click)="getStoredObject(details[4]['Value'], details[3]['Value'], details[5]['Value']); setTypeOfS3ElementToShow(elementTypeOfDetails)">
                        <mat-icon class="icon-display">preview</mat-icon>
                    </button>
                </div>

                <mat-progress-bar *ngIf="loadingS3Object" mode="indeterminate" color="primary"> </mat-progress-bar>
            </mat-sidenav>

            <mat-sidenav class="custom-sidenav-container" #leftSidenav mode="over" opened="false" position="start">
                <button id="close-left-sidenav-button" mat-raised-button color="accent"
                    (click)="leftSidenav.close()">Close preview
                </button>

                <div *ngIf="httpS3Error !== undefined && httpS3Error !== null">
                    <p>Response status code: {{httpS3Error?.status}}</p>
                    <p>Response status text: {{httpS3Error?.statusText}}</p>
                    <p>Response error: {{httpS3Error?.error}}</p>
                </div>

                <div
                    *ngIf="S3Object !== undefined && S3Object !== null && httpS3Error === undefined || httpS3Error === null">
                    <div id="element-preview" [ngSwitch]="typeOfS3ElementToShow">
                        <pre *ngSwitchCase="elementType.OpenXml" lang="xml">{{S3Object}}</pre>
                        <pre *ngSwitchCase="elementType.CloudJson"> {{stringToJsonObject(S3Object) | json}}</pre>
                    </div>
                </div>
            </mat-sidenav>

            <mat-sidenav-content>
                <div id="timeline-page-wrapper">
                    <div id="timelines-wrapper">
                        <div id="openxml-section" class="timeline-section">
                            <p> <strong>OpenXML</strong> section</p>
                            <div *ngIf="httpOpenXmlError !== undefined;">
                                <p>Response status code: {{httpOpenXmlError?.status}}</p>
                                <p>Response status text: {{httpOpenXmlError?.statusText}}</p>
                                <p>Response error: {{httpOpenXmlError?.error}}</p>
                            </div>

                            <div *ngIf="(uploadedXmlTimelineData !== undefined) && (uploadedXmlTimelineData !== null)">
                                <app-single-timeline [timelineData]="uploadedXmlTimelineData"
                                    (changeDataType)="timelineDetailsTypeChangedFromChildComponent($event)">
                                </app-single-timeline>
                            </div>
                            <hr class="solid">
                        </div>

                        <div id="cloudjson-section" class="timeline-section">
                            <p> <strong>CloudJSON</strong> section</p>
                            <div *ngIf="httpCloudJsonError !== undefined;">
                                <p>Response status code: {{httpCloudJsonError?.status}}</p>
                                <p>Response status text: {{httpCloudJsonError?.statusText}}</p>
                                <p>Response error: {{httpCloudJsonError?.error}}</p>
                            </div>

                            <div *ngIf="(cloudJsonTimelineData !== undefined) && (cloudJsonTimelineData !== null)">
                                <app-single-timeline [timelineData]="cloudJsonTimelineData"
                                    (changeDataType)="timelineDetailsTypeChangedFromChildComponent($event)">
                                </app-single-timeline>
                            </div>
                            <hr class="solid">
                        </div>
                    </div>
                </div>
            </mat-sidenav-content>
        </mat-sidenav-container>
    </div>
</ng-template>